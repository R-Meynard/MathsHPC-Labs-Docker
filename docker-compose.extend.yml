# ============================================================================
# Extension pour DevContainer (VS Code Remote Containers)
# ============================================================================

services:
  cpp-dev-tools:
    build:
      args:
        - INCLUDE_DEEPLEARNING=false
        - OPTIMIZATION=true

    environment:
      - DEVELOPMENT_MODE=1
      - VSCODE_MOUNT=/workspace
      - HOME=/home/backend
      - USER=backend

    # Exécuter en tant qu'utilisateur "backend" (s'assurer qu'il est créé dans le Dockerfile)
    user: "backend"

    init: true
    stdin_open: true
    tty: true

    volumes:
      # VS Code Extensions Cache (persist extensions between rebuilds)
      - vscode-extensions:/home/backend/.vscode-server/extensions
      - vscode-insiders:/home/backend/.vscode-server-insiders/extensions

      # Shell Configuration (mount en lecture seule pour éviter écrasement accidentel)
      - ./cpp-dev-tools/.devcontainer/.bashrc:/home/backend/.bashrc:ro
      - ./cpp-dev-tools/.devcontainer/.profile:/home/backend/.profile:ro

      # Git Config (décommentez si vous voulez monter vos configs locales)
      # - ~/.gitconfig:/home/backend/.gitconfig:ro
      # - ~/.git-credentials:/home/backend/.git-credentials:ro

    ports:
      # Development Tools (exposez uniquement ce que vous utilisez)
      - "3310:3306"    # MySQL (optional)
      - "27021:27017"  # MongoDB (optional)
      - "5605:5601"    # Kibana (optional)
      - "9204:9200"    # Elasticsearch (optional)

volumes:
  vscode-extensions:
  vscode-insiders: